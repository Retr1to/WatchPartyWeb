<div class="home-container">
  <div class="main-content">
    <!-- Header Card -->
    <div class="card header-card">
      <div class="icon">
        <app-animated-wave-icon
          [size]="100"
          [strokeWidth]="8"
          [animated]="true"
          [useGradient]="true"
          [withGlow]="true">
        </app-animated-wave-icon>
      </div>

      <h1>WatchTogether</h1>
      <p class="subtitle">Ve videos con tus amigos en tiempo real</p>

      <!-- Not Authenticated -->
      <ng-container *ngIf="!(currentUser$ | async)">
        <div class="auth-buttons">
          <button class="btn btn-primary" (click)="goToLogin()">
            Iniciar SesiÃ³n
          </button>
          <button class="btn btn-secondary" (click)="goToRegister()">
            Registrarse
          </button>
        </div>
      </ng-container>

      <!-- Authenticated -->
      <ng-container *ngIf="currentUser$ | async as user">
        <div class="user-info">
          <div class="user-welcome">
            <span class="user-icon">ğŸ‘¤</span>
            <span class="username">{{ user.username }}</span>
          </div>
          <button class="btn btn-logout" (click)="logout()">Cerrar SesiÃ³n</button>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" (click)="showCreateDialog()">
            <span class="star">âœ¨</span> Crear Sala Nueva
          </button>
          <button class="btn btn-secondary" (click)="showJoinRoomDialog()">
            Unirse a Sala
          </button>
          <button class="btn btn-tertiary" (click)="showFriendManagement()">
            ğŸ‘¥ Gestionar Amigos
          </button>
        </div>
      </ng-container>
    </div>

    <!-- Authenticated Content -->
    <ng-container *ngIf="currentUser$ | async">
      <!-- Public Rooms -->
      <div class="card rooms-card" *ngIf="publicRooms.length > 0">
        <h2>ğŸŒ Salas PÃºblicas</h2>
        <div class="rooms-list">
          <div 
            class="room-item" 
            *ngFor="let room of publicRooms"
            (click)="joinRoomByCode(room.roomCode)">
            <div class="room-info">
              <span class="room-name">{{ room.name || 'Sala sin nombre' }}</span>
              <span class="room-code">{{ room.roomCode }}</span>
            </div>
            <div class="room-meta">
              <span class="room-owner">ğŸ‘‘ {{ room.owner.username }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Friend Rooms -->
      <div class="card rooms-card" *ngIf="friendRooms.length > 0">
        <h2>ğŸ‘¥ Salas de Amigos</h2>
        <div class="rooms-list">
          <div 
            class="room-item" 
            *ngFor="let room of friendRooms"
            (click)="joinRoomByCode(room.roomCode)">
            <div class="room-info">
              <span class="room-name">{{ room.name || 'Sala sin nombre' }}</span>
              <span class="room-code">{{ room.roomCode }}</span>
            </div>
            <div class="room-meta">
              <span class="room-owner">ğŸ‘‘ {{ room.owner.username }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Friends List -->
      <div class="card friends-card" *ngIf="friends.length > 0">
        <h2>âœ¨ Mis Amigos</h2>
        <div class="friends-list">
          <div class="friend-item" *ngFor="let friend of friends">
            <span class="friend-icon">ğŸ‘¤</span>
            <span class="friend-name">{{ friend.username }}</span>
          </div>
        </div>
      </div>

      <!-- Pending Requests -->
      <div class="card requests-card" *ngIf="pendingRequests.length > 0">
        <h2>ğŸ“¬ Solicitudes Pendientes</h2>
        <div class="requests-list">
          <div class="request-item" *ngFor="let request of pendingRequests">
            <div class="request-info">
              <span class="request-icon">ğŸ‘¤</span>
              <span class="request-from">{{ request.from.username }}</span>
            </div>
            <div class="request-actions">
              <button class="btn-small btn-accept" (click)="acceptFriendRequest(request.id)">âœ“</button>
              <button class="btn-small btn-reject" (click)="rejectFriendRequest(request.id)">âœ—</button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Create Room Dialog -->
  <div class="modal" *ngIf="showCreateRoomDialog" (click)="closeCreateDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Crear Sala Nueva</h2>
      <input
        type="text"
        [(ngModel)]="roomName"
        placeholder="Nombre de la sala"
        maxlength="50"
      />
      <div class="visibility-options">
        <label class="radio-option">
          <input type="radio" name="visibility" value="Public" [(ngModel)]="roomVisibility" />
          <span>ğŸŒ PÃºblica</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="visibility" value="Private" [(ngModel)]="roomVisibility" />
          <span>ğŸ”’ Privada</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="visibility" value="Friends" [(ngModel)]="roomVisibility" />
          <span>ğŸ‘¥ Amigos</span>
        </label>
      </div>
      <div class="modal-buttons">
        <button class="btn btn-secondary" (click)="closeCreateDialog()">Cancelar</button>
        <button class="btn btn-primary" (click)="createNewRoom()">Crear</button>
      </div>
    </div>
  </div>

  <!-- Join Room Dialog -->
  <div class="modal" *ngIf="showJoinDialog" (click)="closeDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Unirse a Sala</h2>
      <input
        type="text"
        [(ngModel)]="roomCode"
        placeholder="CÃ³digo de sala (ej: ADDHR)"
        maxlength="6"
        (input)="roomCode = roomCode.toUpperCase()"
      />
      <div class="modal-buttons">
        <button class="btn btn-secondary" (click)="closeDialog()">Cancelar</button>
        <button class="btn btn-primary" (click)="joinRoom()">Unirse</button>
      </div>
    </div>
  </div>

  <!-- Friend Management Dialog -->
  <div class="modal" *ngIf="showFriendDialog" (click)="closeFriendDialog()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <h2>Gestionar Amigos</h2>
      
      <div class="friend-section">
        <h3>Enviar Solicitud</h3>
        <div class="friend-input-group">
          <input
            type="email"
            [(ngModel)]="friendEmail"
            placeholder="Email del amigo"
          />
          <button class="btn btn-primary" (click)="sendFriendRequest()">Enviar</button>
        </div>
      </div>

      <div class="friend-section" *ngIf="pendingRequests.length > 0">
        <h3>Solicitudes Pendientes ({{ pendingRequests.length }})</h3>
        <div class="requests-list">
          <div class="request-item" *ngFor="let request of pendingRequests">
            <div class="request-info">
              <span class="request-icon">ğŸ‘¤</span>
              <div class="request-details">
                <span class="request-from">{{ request.from.username }}</span>
                <span class="request-email">{{ request.from.email }}</span>
              </div>
            </div>
            <div class="request-actions">
              <button class="btn-small btn-accept" (click)="acceptFriendRequest(request.id)">Aceptar</button>
              <button class="btn-small btn-reject" (click)="rejectFriendRequest(request.id)">Rechazar</button>
            </div>
          </div>
        </div>
      </div>

      <div class="friend-section" *ngIf="friends.length > 0">
        <h3>Mis Amigos ({{ friends.length }})</h3>
        <div class="friends-list">
          <div class="friend-item" *ngFor="let friend of friends">
            <span class="friend-icon">ğŸ‘¤</span>
            <div class="friend-details">
              <span class="friend-name">{{ friend.username }}</span>
              <span class="friend-email">{{ friend.email }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-secondary" (click)="closeFriendDialog()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
